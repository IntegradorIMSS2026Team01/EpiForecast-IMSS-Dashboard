<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Construcción del Dashboard Tableau — EpiForecast-MX</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Source+Sans+3:ital,wght@0,300;0,400;0,600;0,700;1,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --burgundy:#9B2242;--dark-burgundy:#6F1D46;--teal:#00524E;--dark-teal:#173F35;
  --gold:#B58500;--cream:#E8D5B5;--cream-light:#F5EDE0;--cream-pale:#FAF6F0;
  --cool-gray:#97999B;--neutral-black:#231F20;
  --burgundy-light:#D4758B;--teal-light:#4A9E9A;--gold-light:#D4B24A;
  --font-display:'DM Serif Display',Georgia,serif;
  --font-body:'Source Sans 3','Source Sans Pro',sans-serif;
  --font-mono:'JetBrains Mono','Fira Code',monospace;
  --shadow-sm:0 2px 8px rgba(0,0,0,.06);--shadow-md:0 8px 24px rgba(0,0,0,.06);
  --shadow-lg:0 16px 48px rgba(0,0,0,.06);--radius:16px;--radius-sm:10px;
}
body{font-family:var(--font-body);background:var(--cream-pale);color:var(--neutral-black);line-height:1.7;-webkit-font-smoothing:antialiased}
body::before{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");opacity:.025;pointer-events:none;z-index:0}

/* Nav */
.nav{position:fixed;top:0;left:0;right:0;z-index:1000;background:rgba(23,63,53,.92);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border-bottom:1px solid rgba(232,213,181,.08);transition:box-shadow .3s,background .3s}.nav.scrolled{box-shadow:0 4px 30px rgba(0,0,0,.18);background:rgba(23,63,53,.97)}.nav-inner{max-width:1200px;margin:0 auto;padding:0 2rem;display:flex;align-items:center;height:64px;gap:1rem}.nav-logo{font-family:var(--font-display);font-size:1.3rem;color:var(--cream);letter-spacing:.02em;flex-shrink:0;text-decoration:none}.nav-logo span{color:var(--gold)}.nav-menu{display:flex;align-items:center;gap:.25rem;list-style:none;flex:1;justify-content:center}.nav-group{position:relative}.nav-group-toggle{display:flex;align-items:center;gap:.3rem;color:rgba(232,213,181,.65);font-size:.78rem;font-weight:600;text-transform:uppercase;letter-spacing:.08em;padding:.5rem .85rem;border-radius:6px;cursor:pointer;transition:color .2s,background .2s;white-space:nowrap;border:none;background:none;font-family:inherit}.nav-group-toggle:hover,.nav-group:hover .nav-group-toggle{color:var(--cream);background:rgba(232,213,181,.06)}.nav-group-toggle svg{width:10px;height:10px;opacity:.5;transition:transform .2s}.nav-group:hover .nav-group-toggle svg{transform:rotate(180deg);opacity:.8}.nav-dropdown{position:absolute;top:calc(100% + 8px);left:50%;transform:translateX(-50%) translateY(-4px);background:rgba(23,63,53,.98);backdrop-filter:blur(16px);border:1px solid rgba(232,213,181,.1);border-radius:12px;padding:.5rem;min-width:200px;opacity:0;visibility:hidden;transition:opacity .15s,transform .15s,visibility .15s;box-shadow:0 12px 40px rgba(0,0,0,.25)}.nav-group:hover .nav-dropdown{opacity:1;visibility:visible;transform:translateX(-50%) translateY(0)}.nav-dropdown::before{content:'';position:absolute;top:-8px;left:0;right:0;height:8px}.nav-dropdown a{display:flex;align-items:center;gap:.75rem;padding:.6rem 1rem;color:rgba(232,213,181,.7);font-size:.82rem;font-weight:500;border-radius:8px;transition:background .15s,color .15s;text-decoration:none;white-space:nowrap}.nav-dropdown a:hover{background:rgba(232,213,181,.08);color:var(--cream)}.nav-dropdown a svg{width:16px;height:16px;opacity:.5;flex-shrink:0}.nav-dropdown a:hover svg{opacity:.8}.nav-ctas{display:flex;gap:.5rem;align-items:center;flex-shrink:0}.nav-cta{display:inline-flex;align-items:center;gap:.4rem;padding:.4rem 1rem;font-size:.75rem;font-weight:700;text-transform:uppercase;letter-spacing:.06em;border-radius:100px;text-decoration:none;transition:transform .2s,box-shadow .2s,background .2s;white-space:nowrap}.nav-cta:hover{transform:translateY(-1px);box-shadow:0 4px 16px rgba(181,133,0,.3)}.nav-cta--primary{background:var(--gold);color:var(--dark-teal)}.nav-cta--secondary{background:rgba(232,213,181,.1);color:var(--gold);border:1px solid rgba(181,133,0,.3)}.nav-cta--secondary:hover{background:rgba(181,133,0,.15);color:var(--gold)}.nav-cta svg{width:14px;height:14px}.nav-hamburger{display:none;flex-direction:column;gap:5px;cursor:pointer;padding:4px}.nav-hamburger span{width:24px;height:2px;background:var(--cream);transition:transform .3s,opacity .3s}.nav-mobile{display:none;flex-direction:column;background:rgba(23,63,53,.98);backdrop-filter:blur(16px);padding:1rem 2rem 1.5rem;border-bottom:1px solid rgba(232,213,181,.1)}.nav-mobile.show{display:flex}.nav-mobile-group{border-bottom:1px solid rgba(232,213,181,.06)}.nav-mobile-heading{display:flex;align-items:center;justify-content:space-between;padding:.85rem 0;color:rgba(232,213,181,.7);font-size:.82rem;font-weight:600;text-transform:uppercase;letter-spacing:.08em;cursor:pointer}.nav-mobile-heading svg{width:10px;height:10px;transition:transform .2s}.nav-mobile-group.open .nav-mobile-heading svg{transform:rotate(180deg)}.nav-mobile-items{display:none;flex-direction:column;padding-bottom:.5rem}.nav-mobile-group.open .nav-mobile-items{display:flex}.nav-mobile-items a{padding:.5rem 1rem;color:rgba(232,213,181,.55);font-size:.82rem;text-decoration:none;border-radius:6px;transition:background .15s,color .15s}.nav-mobile-items a:hover{background:rgba(232,213,181,.06);color:var(--cream)}.nav-mobile-ctas{display:flex;gap:.5rem;margin-top:1rem}@media(max-width:768px){.nav-menu,.nav-ctas{display:none}.nav-hamburger{display:flex}}

.container{max-width:1200px;margin:0 auto;padding:0 2rem;position:relative;z-index:1}
section{padding:4rem 0}
.section-title{font-family:var(--font-display);font-size:clamp(1.8rem,4vw,2.5rem);margin-bottom:.5rem;color:var(--dark-teal)}
.section-sub{color:var(--cool-gray);font-size:1rem;margin-bottom:2.5rem}

/* Hero */
.hero{padding:10rem 2rem 6rem;text-align:center;background:linear-gradient(170deg,#0a1628 0%,var(--dark-teal) 40%,var(--teal) 70%,rgba(0,82,78,.85) 100%);color:var(--cream-pale);position:relative;overflow:hidden}
.hero::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse 800px 600px at 30% 20%,rgba(181,133,0,.12),transparent),radial-gradient(ellipse 600px 500px at 70% 80%,rgba(155,34,66,.08),transparent);pointer-events:none}
.hero::after{content:'';position:absolute;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");opacity:.04;pointer-events:none}
.hero h1{font-family:var(--font-display);font-size:clamp(2.5rem,6vw,4.5rem);line-height:1.1;margin-bottom:1rem;position:relative}
.hero h1 em{font-style:italic;color:var(--gold-light)}
.hero .subtitle{font-size:clamp(1rem,2vw,1.25rem);opacity:.8;font-weight:300;margin-bottom:1rem;position:relative}
.hero .subtitle2{font-size:clamp(.85rem,1.5vw,1rem);opacity:.5;font-weight:400;margin-bottom:3rem;position:relative;font-family:var(--font-mono)}
.hero-kpis{display:flex;justify-content:center;gap:1.5rem;flex-wrap:wrap;position:relative}
.hero-kpi{background:rgba(255,255,255,.07);border:1px solid rgba(232,213,181,.12);border-radius:var(--radius);padding:1.5rem 2rem;backdrop-filter:blur(8px);min-width:140px;transition:transform .3s,box-shadow .3s}
.hero-kpi:hover{transform:translateY(-4px);box-shadow:0 12px 32px rgba(0,0,0,.2)}
.hero-kpi .value{font-family:var(--font-display);font-size:2.5rem;display:block;background:linear-gradient(135deg,var(--cream),var(--gold-light));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero-kpi .label{font-size:.8rem;text-transform:uppercase;letter-spacing:1px;opacity:.6}

/* Cards */
.card{background:#fff;border-radius:var(--radius);padding:2rem;box-shadow:var(--shadow-md);border:1px solid rgba(0,0,0,.04);transition:transform .3s,box-shadow .3s;overflow:hidden}
.card:hover{transform:translateY(-3px);box-shadow:var(--shadow-lg)}
.card-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:2rem}
.card-grid-3{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.5rem}
.card-header{display:flex;align-items:center;gap:.75rem;margin-bottom:1.5rem;padding-bottom:1rem;border-bottom:2px solid var(--cream-light)}
.card-dot{width:14px;height:14px;border-radius:50%;flex-shrink:0;box-shadow:0 0 8px currentColor}
.card-title{font-family:var(--font-display);font-size:1.4rem}

/* Chart */
.chart-wrap{background:#fff;border-radius:var(--radius);padding:2rem;box-shadow:var(--shadow-md);border:1px solid rgba(0,0,0,.04)}
.chart-wrap canvas{max-height:400px}
.chart-wrap h3{font-family:var(--font-display);font-size:1.3rem;color:var(--dark-teal);margin-bottom:.25rem}
.chart-wrap .chart-sub{font-size:.85rem;color:var(--cool-gray);margin-bottom:1.5rem}
.charts-row{display:grid;grid-template-columns:1fr 1fr;gap:2rem;margin-top:2rem}

/* Callout */
.callout{background:linear-gradient(135deg,rgba(0,82,78,.06),rgba(181,133,0,.04));border:1px solid rgba(0,82,78,.15);border-left:4px solid var(--teal);border-radius:0 var(--radius-sm) var(--radius-sm) 0;padding:1.5rem 2rem;margin:2rem 0;font-size:.95rem}
.callout-gold{border-left-color:var(--gold);background:linear-gradient(135deg,rgba(181,133,0,.06),rgba(155,34,66,.03))}
.callout-burgundy{border-left-color:var(--burgundy);background:linear-gradient(135deg,rgba(155,34,66,.06),rgba(0,82,78,.03))}
.callout strong{color:var(--dark-teal)}
.callout-gold strong{color:var(--gold)}
.callout-burgundy strong{color:var(--burgundy)}

/* Badge */
.badge{display:inline-block;padding:.2rem .7rem;border-radius:100px;font-family:var(--font-mono);font-size:.8rem;font-weight:500}
.badge-green{background:#e6f4ea;color:#1a7431}
.badge-yellow{background:#fef7e0;color:#8a6d00}
.badge-red{background:#fde8e8;color:#b91c1c}
.badge-teal{background:rgba(0,82,78,.1);color:var(--teal)}

/* Code */
.code-block{background:var(--neutral-black);color:#e0e0e0;border-radius:var(--radius-sm);padding:1.25rem 1.5rem;font-family:var(--font-mono);font-size:.82rem;line-height:1.6;overflow-x:auto;margin:1.5rem 0;position:relative}
.code-block .kw{color:#c792ea}
.code-block .fn{color:#82aaff}
.code-block .st{color:#c3e88d}
.code-block .cm{color:#546e7a}
.code-block .num{color:#f78c6c}
.code-block .op{color:#89ddff}
.code-label{position:absolute;top:.5rem;right:.75rem;font-size:.7rem;text-transform:uppercase;letter-spacing:1px;color:var(--cool-gray);opacity:.6}

/* YAML */
.yaml-block{background:var(--cream-light);border-left:4px solid var(--teal);border-radius:0 var(--radius-sm) var(--radius-sm) 0;padding:1.25rem 1.5rem;font-family:var(--font-mono);font-size:.82rem;line-height:1.6;overflow-x:auto;margin:1.5rem 0}
.yaml-key{color:var(--teal);font-weight:500}
.yaml-val{color:var(--burgundy)}
.yaml-cm{color:var(--cool-gray)}

/* Pipeline steps — redesigned */
.pipeline-steps{display:grid;grid-template-columns:repeat(4,1fr);gap:1.25rem 1.5rem;margin:2rem 0;position:relative}
.pipeline-step{position:relative;background:#fff;border-radius:var(--radius);padding:1.25rem 1rem .75rem;text-align:center;box-shadow:var(--shadow-sm);border:1px solid rgba(0,0,0,.04);transition:transform .3s,box-shadow .3s}
.pipeline-step:hover{transform:translateY(-3px);box-shadow:var(--shadow-md)}
.pipeline-step .step-num{display:inline-flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:50%;font-family:var(--font-mono);font-size:.9rem;font-weight:700;margin-bottom:.6rem;color:#fff}
.pipeline-step .step-num.c-teal{background:var(--teal)}
.pipeline-step .step-num.c-gold{background:var(--gold)}
.pipeline-step .step-num.c-burgundy{background:var(--burgundy)}
.pipeline-step .step-label{font-family:var(--font-display);font-size:1rem;color:var(--dark-teal);display:block;margin-bottom:.25rem}
.pipeline-step .step-desc{font-size:.78rem;color:var(--cool-gray);line-height:1.4}
.pipeline-step .step-fn{display:inline-block;margin-top:.5rem;font-family:var(--font-mono);font-size:.7rem;background:var(--cream-light);color:var(--dark-teal);padding:.15rem .5rem;border-radius:4px}
/* connector arrows between steps */
.pipeline-step:not(:nth-child(4n))::after{content:'';position:absolute;right:-1rem;top:50%;width:.75rem;height:2px;background:var(--gold)}
.pipeline-step:not(:nth-child(4n))::before{content:'';position:absolute;right:-1.1rem;top:50%;transform:translateY(-50%);border:5px solid transparent;border-left:6px solid var(--gold)}
/* row connector: last col to next row first col */
.pipeline-step:nth-child(4)::after,.pipeline-step:nth-child(4)::before{display:none}

/* Table */
.compare-table{width:100%;border-collapse:collapse;margin:1.5rem 0;font-size:.9rem}
.compare-table thead th{background:var(--dark-teal);color:var(--cream);padding:.75rem 1rem;text-align:left;font-weight:600;font-size:.8rem;text-transform:uppercase;letter-spacing:.5px}
.compare-table tbody td{padding:.7rem 1rem;border-bottom:1px solid var(--cream-light)}
.compare-table tbody tr:hover{background:var(--cream-light)}

/* Timeline */
.timeline{position:relative;padding:2rem 0 2rem 3rem}
.timeline::before{content:'';position:absolute;left:1rem;top:0;bottom:0;width:3px;background:linear-gradient(180deg,var(--teal),var(--gold),var(--burgundy));border-radius:2px}
.tl-item{position:relative;margin-bottom:2.5rem}
.tl-item::before{content:'';position:absolute;left:-2.35rem;top:.5rem;width:14px;height:14px;border-radius:50%;background:var(--teal);border:3px solid #fff;box-shadow:0 0 0 3px var(--teal)}
.tl-item:nth-child(2)::before{background:var(--gold);box-shadow:0 0 0 3px var(--gold)}
.tl-item:nth-child(3)::before{background:var(--burgundy);box-shadow:0 0 0 3px var(--burgundy)}
.tl-version{font-family:var(--font-mono);font-size:.8rem;font-weight:500;color:var(--burgundy);text-transform:uppercase;letter-spacing:1px;margin-bottom:.25rem}
.tl-title{font-family:var(--font-display);font-size:1.3rem;color:var(--dark-teal);margin-bottom:.5rem}
.tl-desc{font-size:.92rem;color:#555;line-height:1.7}

/* Viz grid */
.viz-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:2rem;margin-top:2rem}
.viz-card{background:#fff;border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow-md);border:1px solid rgba(0,0,0,.04);transition:transform .3s,box-shadow .3s}
.viz-card:hover{transform:translateY(-3px);box-shadow:var(--shadow-lg)}
.viz-card-num{display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;border-radius:50%;background:var(--teal);color:#fff;font-family:var(--font-mono);font-size:.85rem;font-weight:600;margin-right:.75rem;flex-shrink:0}
.viz-card-head{padding:1.5rem 2rem 1rem;display:flex;align-items:center}
.viz-card-head h3{font-family:var(--font-display);font-size:1.2rem;color:var(--dark-teal)}
.viz-card-body{padding:0 2rem 1.5rem;font-size:.9rem;color:#555;line-height:1.7}
.viz-card-foot{background:var(--cream-pale);padding:.75rem 2rem;font-family:var(--font-mono);font-size:.75rem;color:var(--cool-gray)}

/* Reveal */
.reveal{opacity:0;transform:translateY(30px);transition:opacity .6s ease,transform .6s ease}
.reveal.visible{opacity:1;transform:translateY(0)}

/* Footer */
footer{background:var(--dark-teal);color:rgba(232,213,181,.7);padding:3rem 2rem;text-align:center;font-size:.85rem;position:relative;z-index:1}
footer a{color:var(--gold-light);text-decoration:none}
footer a:hover{color:var(--cream)}
footer .footer-title{font-family:var(--font-display);color:var(--cream);font-size:1.2rem;margin-bottom:.5rem}

/* Flow diagram */
.flow-diagram{display:flex;flex-direction:column;gap:0;align-items:center;margin:2rem 0}
.flow-row{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap;justify-content:center}
.flow-box{background:#fff;border:2px solid var(--teal);border-radius:var(--radius-sm);padding:.6rem 1.2rem;font-size:.82rem;font-weight:600;color:var(--dark-teal);text-align:center;min-width:100px}
.flow-box.data{border-color:var(--gold);background:rgba(181,133,0,.06)}
.flow-box.script{border-color:var(--teal);background:rgba(0,82,78,.06)}
.flow-box.output{border-color:var(--burgundy);background:rgba(155,34,66,.06)}
.flow-box.cloud{border-color:#5C6BC0;background:rgba(92,107,192,.06)}
.flow-arrow-down{color:var(--cool-gray);font-size:1.2rem;text-align:center;padding:.25rem 0}

/* Responsive */
@media(max-width:768px){
  .hero{padding:8rem 1.5rem 4rem}.hero-kpis{gap:1rem}.hero-kpi{min-width:130px;padding:1rem}.hero-kpi .value{font-size:2rem}
  .container{padding:0 1.25rem}
  .charts-row{grid-template-columns:1fr}
  .card-grid,.card-grid-3,.viz-grid{grid-template-columns:1fr}
  .pipeline-steps{grid-template-columns:repeat(2,1fr);gap:1rem}
  .pipeline-step:not(:nth-child(4n))::after,.pipeline-step:not(:nth-child(4n))::before{display:none}
  .pipeline-step:nth-child(odd):not(:last-child)::after{content:'';display:block;position:absolute;right:-0.75rem;top:50%;width:.5rem;height:2px;background:var(--gold)}
  .pipeline-step:nth-child(odd):not(:last-child)::before{content:'';display:block;position:absolute;right:-.85rem;top:50%;transform:translateY(-50%);border:4px solid transparent;border-left:5px solid var(--gold)}
}
</style>
</head>
<body>

<nav class="nav" id="nav">
    <div class="nav-inner">
      <a href="index.html" class="nav-logo" style="text-decoration:none">EpiForecast<span>-MX</span></a>
      <ul class="nav-menu">
        <li class="nav-group">
          <button class="nav-group-toggle">Proyecto <svg viewBox="0 0 10 6" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 1l4 4 4-4"/></svg></button>
          <div class="nav-dropdown">
            <a href="index.html"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>Inicio</a>
            <a href="EpiDashboard.html"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>Dashboard</a>
            <a href="Reports/index.html"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>Pronósticos</a>
          </div>
        </li>
        <li class="nav-group">
          <button class="nav-group-toggle">Metodología <svg viewBox="0 0 10 6" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 1l4 4 4-4"/></svg></button>
          <div class="nav-dropdown">
            <a href="bitacora_modelado.html"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>Bitácora v1-v6</a>
            <a href="ficha_tecnica_prophet.html"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>Ficha Prophet</a>
            <a href="hiperparametros_modelos.html"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>HPs SageMaker</a>
            <a href="construccion_dashboard.html"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></svg>Arquitectura Dashboard</a>
          </div>
        </li>
        <li class="nav-group">
          <button class="nav-group-toggle">Resultados <svg viewBox="0 0 10 6" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 1l4 4 4-4"/></svg></button>
          <div class="nav-dropdown">
            <a href="reporte_resultados.html"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><path d="M9 15l2 2 4-4"/></svg>Resultados</a>
            <a href="comparacion_modelos.html"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>Comparación SageMaker</a>
            <a href="conclusiones.html"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>Conclusiones</a>
            <a href="referencias.html"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>Referencias</a>
          </div>
        </li>
      </ul>
      <div class="nav-ctas">
        <a href="EpiDashboard.html" class="nav-cta nav-cta--primary">Dashboard</a>
        <a href="https://github.com/IntegradorIMSS2026Team01" target="_blank" rel="noopener" class="nav-cta nav-cta--secondary" style="padding:0.4rem 0.6rem" title="GitHub"><svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg></a>
      </div>
      <div class="nav-hamburger" onclick="document.getElementById('navMobile').classList.toggle('show')" aria-label="Menú"><span></span><span></span><span></span></div>
    </div>
    <div class="nav-mobile" id="navMobile">
      <div class="nav-mobile-group">
        <div class="nav-mobile-heading" onclick="this.parentElement.classList.toggle('open')">Proyecto <svg viewBox="0 0 10 6" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 1l4 4 4-4"/></svg></div>
        <div class="nav-mobile-items"><a href="index.html">Inicio</a><a href="EpiDashboard.html">Dashboard</a><a href="Reports/index.html">Pronósticos</a></div>
      </div>
      <div class="nav-mobile-group">
        <div class="nav-mobile-heading" onclick="this.parentElement.classList.toggle('open')">Metodología <svg viewBox="0 0 10 6" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 1l4 4 4-4"/></svg></div>
        <div class="nav-mobile-items"><a href="bitacora_modelado.html">Bitácora v1-v6</a><a href="ficha_tecnica_prophet.html">Ficha Prophet</a><a href="hiperparametros_modelos.html">HPs SageMaker</a><a href="construccion_dashboard.html">Arquitectura Dashboard</a></div>
      </div>
      <div class="nav-mobile-group">
        <div class="nav-mobile-heading" onclick="this.parentElement.classList.toggle('open')">Resultados <svg viewBox="0 0 10 6" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 1l4 4 4-4"/></svg></div>
        <div class="nav-mobile-items"><a href="reporte_resultados.html">Resultados</a><a href="comparacion_modelos.html">Comparación SageMaker</a><a href="conclusiones.html">Conclusiones</a><a href="referencias.html">Referencias</a></div>
      </div>
      <div class="nav-mobile-ctas"><a href="EpiDashboard.html" class="nav-cta nav-cta--primary" style="justify-content:center;padding:.6rem 1.5rem;flex:1">Dashboard</a></div>
    </div>
  </nav>

<!-- ═══════════ HERO ═══════════ -->
<section class="hero">
  <h1>Construcción del <em>Dashboard</em></h1>
  <p class="subtitle">Del dato crudo a la visualización interactiva en Tableau Public</p>
  <p class="subtitle2">Diagnóstico post-entrenamiento, pipeline de datos, migración y automatización</p>
  <div class="hero-kpis">
    <div class="hero-kpi"><span class="value">8</span><span class="label">Visualizaciones</span></div>
    <div class="hero-kpi"><span class="value">297</span><span class="label">Modelos Prophet</span></div>
    <div class="hero-kpi"><span class="value">4</span><span class="label">Llaves de join</span></div>
    <div class="hero-kpi"><span class="value">3</span><span class="label">Avances iterativos</span></div>
    <div class="hero-kpi"><span class="value">1</span><span class="label">Dataset integrado</span></div>
  </div>
</section>

<!-- ═══════════ 1. VISION GENERAL ═══════════ -->
<div class="container">

<section class="reveal" id="vision">
  <h2 class="section-title">Visión general</h2>
  <p class="section-sub">De boletines epidemiológicos a un dashboard interactivo embebido en la web</p>

  <div class="callout">
    <strong>Objetivo del dashboard:</strong> Permitir a investigadores del IMSS y stakeholders del Tec de Monterrey explorar interactivamente datos históricos (2014-2026) y predicciones a 52 semanas de tres padecimientos neurológicos (Depresión F32, Parkinson G20, Alzheimer G30), desagregados por entidad federativa, sexo y semana epidemiológica.
  </div>

  <div class="card" style="margin-top:2rem">
    <h3 style="font-family:var(--font-display);font-size:1.3rem;color:var(--dark-teal);margin-bottom:1rem">El problema no estaba en Tableau</h3>
    <p>Tras la fase de entrenamiento, las fechas futuras desaparecían al filtrar por entidad o padecimiento en Tableau. La persistencia del error incluso en vistas simplificadas reveló que el defecto no era visual sino <strong>estructural</strong>: estaba en la integración de datos aguas abajo del entrenamiento. El diagnóstico completo, la reconstrucción del pipeline y la migración a un dataset único (<code>tableau.csv</code>) constituyen el núcleo de este reporte.</p>
  </div>
</section>

<!-- ═══════════ 2. ARQUITECTURA ═══════════ -->
<section class="reveal" id="arquitectura">
  <h2 class="section-title">Arquitectura de datos</h2>
  <p class="section-sub">Pipeline completo: desde SINAVE hasta Tableau Public</p>

  <div class="flow-diagram">
    <div class="flow-row">
      <div class="flow-box data">SINAVE PDFs<br><span style="font-size:.7rem;opacity:.6">~633 boletines</span></div>
      <span class="pipeline-arrow">&rarr;</span>
      <div class="flow-box script">Extracción<br><span style="font-size:.7rem;opacity:.6">Camelot + PyPDF</span></div>
      <span class="pipeline-arrow">&rarr;</span>
      <div class="flow-box data">dataset_boletin.csv</div>
    </div>
    <div class="flow-arrow-down">&darr;</div>
    <div class="flow-row">
      <div class="flow-box script">make preprocess<br><span style="font-size:.7rem;opacity:.6">filter &rarr; clean &rarr; transform &rarr; mapper</span></div>
    </div>
    <div class="flow-arrow-down">&darr;</div>
    <div class="flow-row">
      <div class="flow-box data">data_inegi_General.csv<br><span style="font-size:.7rem;opacity:.6">Histórico + INEGI</span></div>
    </div>
    <div class="flow-arrow-down">&darr;</div>
    <div class="flow-row">
      <div class="flow-box script">make train<br><span style="font-size:.7rem;opacity:.6">Prophet CV + modelos .pkl</span></div>
      <span class="pipeline-arrow">&rarr;</span>
      <div class="flow-box script">make predict<br><span style="font-size:.7rem;opacity:.6">predice.py + fallback híbrido</span></div>
      <span class="pipeline-arrow">&rarr;</span>
      <div class="flow-box data">all_forecast.csv<br><span style="font-size:.7rem;opacity:.6">~180 MB</span></div>
    </div>
    <div class="flow-arrow-down">&darr;</div>
    <div class="flow-row">
      <div class="flow-box highlight" style="border-color:var(--burgundy);background:rgba(155,34,66,.08)">make tableau<br><span style="font-size:.7rem;opacity:.6">build_tableau.py</span></div>
      <span class="pipeline-arrow">&rarr;</span>
      <div class="flow-box output">tableau.csv<br><span style="font-size:.7rem;opacity:.6">Dataset integrado final</span></div>
    </div>
    <div class="flow-arrow-down">&darr;</div>
    <div class="flow-row">
      <div class="flow-box cloud">Tableau Public<br><span style="font-size:.7rem;opacity:.6">8 visualizaciones embebidas</span></div>
      <span class="pipeline-arrow">&rarr;</span>
      <div class="flow-box cloud">EpiDashboard.html<br><span style="font-size:.7rem;opacity:.6">proyectointegrador.org</span></div>
    </div>
  </div>

  <div class="callout-gold callout" style="margin-top:2rem">
    <strong>Principio rector:</strong> Pipeline reproducible &rarr; Publicación automatizada &rarr; Consumo visual. El dashboard es la consecuencia del pipeline, no un artefacto ad hoc.
  </div>
</section>

<!-- ═══════════ 3. DIAGNÓSTICO ═══════════ -->
<section class="reveal" id="diagnostico">
  <h2 class="section-title">Diagnóstico post-entrenamiento</h2>
  <p class="section-sub">El pipeline fallaba por inconsistencias en el dataset, no por Tableau</p>

  <div class="card-grid">
    <div class="card">
      <div class="card-header">
        <div class="card-dot" style="color:var(--burgundy)"></div>
        <h3 class="card-title">Semana 53 vs Semana 1</h3>
      </div>
      <p style="font-size:.92rem;color:#555">Se detectaron <strong>duplicados reales</strong> en el histórico INEGI en fechas específicas (<code>2014-12-29</code> y <code>2025-12-29</code>) por colisión entre Semana 53 y Semana 1. Esto rompía la unicidad esperada para los joins y provocaba filas fantasma que desaparecían al filtrar.</p>
      <div class="code-block" style="margin-top:1rem">
        <span class="code-label">build_tableau.py</span>
<span class="cm"># Fix determinista: preferir Semana 53 cuando existe</span>
<span class="kw">if</span> <span class="st">"Semana"</span> <span class="kw">in</span> real.columns:
    special_ds = pd.to_datetime([<span class="st">"2014-12-29"</span>, <span class="st">"2025-12-29"</span>])
    is_special = real[<span class="st">"ds"</span>].isin(special_ds)
    <span class="kw">if</span> is_special.any():
        b = real.loc[is_special].copy()
        b[<span class="st">"_wk_pref"</span>] = (b[<span class="st">"Semana"</span>] == <span class="num">53</span>).astype(<span class="kw">int</span>)
        b = b.sort_values(...).drop_duplicates(keep=<span class="st">"first"</span>)
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <div class="card-dot" style="color:var(--teal)"></div>
        <h3 class="card-title">Política de NaN</h3>
      </div>
      <p style="font-size:.92rem;color:#555">Se decidió <strong>no inventar datos</strong>: no rellenar <code>yhat</code> donde no existe, no mezclar valores reales con forecast, y mantener NaN como ausencia real de información. El dataset se construye con <code>outer join</code> y una validación mínima correcta: prohibir NaN <strong>solo</strong> en llaves críticas.</p>
      <div class="code-block" style="margin-top:1rem">
        <span class="code-label">Validación</span>
key_cols = [<span class="st">"ds"</span>, <span class="st">"padecimiento"</span>, <span class="st">"entidad"</span>, <span class="st">"meta_modo"</span>]
bad_keys = out[key_cols].isna().sum()
<span class="kw">if</span> <span class="kw">not</span> bad_keys.empty:
    <span class="kw">raise</span> ValueError(<span class="st">"NaN en llaves criticas"</span>)
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <div class="card-dot" style="color:var(--gold)"></div>
        <h3 class="card-title">Triple conteo de modos</h3>
      </div>
      <p style="font-size:.92rem;color:#555">Al expandir el histórico a <code>general/hombres/mujeres</code>, se evitó inflar <code>SUM(Incrementos_*)</code> en Tableau dejando poblado <strong>solo</strong> el incremento correspondiente al modo y poniendo NaN en los otros dos. Así, filtrar por <code>meta_modo=hombres</code> solo cuenta hombres.</p>
      <div class="code-block" style="margin-top:1rem">
        <span class="code-label">expand_real_by_modo</span>
g = r.assign(meta_modo=<span class="st">"general"</span>,  y_real=r[<span class="st">"incrementos_total"</span>])
h = r.assign(meta_modo=<span class="st">"hombres"</span>,  y_real=r[<span class="st">"incrementos_hombres"</span>])
m = r.assign(meta_modo=<span class="st">"mujeres"</span>,  y_real=r[<span class="st">"incrementos_mujeres"</span>])
<span class="cm"># Solo el incremento del modo queda poblado</span>
g = g.assign(incrementos_hombres=pd.NA, incrementos_mujeres=pd.NA)
      </div>
    </div>
  </div>
</section>

<!-- ═══════════ 4. PIPELINE BUILD_TABLEAU ═══════════ -->
<section class="reveal" id="pipeline">
  <h2 class="section-title">Pipeline: <code>build_tableau.py</code></h2>
  <p class="section-sub">8 pasos para construir el dataset integrado de visualización</p>

  <div class="pipeline-steps">
    <div class="pipeline-step">
      <span class="step-num c-teal">A</span>
      <span class="step-label">Lectura</span>
      <span class="step-desc">Histórico INEGI + all_forecast.csv</span>
      <span class="step-fn">load_inputs()</span>
    </div>
    <div class="pipeline-step">
      <span class="step-num c-teal">B</span>
      <span class="step-label">Parse fechas</span>
      <span class="step-desc">Fecha&rarr;ds, mapeo columnas, limpieza</span>
      <span class="step-fn">prepare_inputs()</span>
    </div>
    <div class="pipeline-step">
      <span class="step-num c-gold">C</span>
      <span class="step-label">Fix Sem. 53</span>
      <span class="step-desc">Desambigua 2014-12-29 y 2025-12-29</span>
      <span class="step-fn">drop_duplicates()</span>
    </div>
    <div class="pipeline-step">
      <span class="step-num c-teal">D</span>
      <span class="step-label">Expansión</span>
      <span class="step-desc">Triplica a general / hombres / mujeres</span>
      <span class="step-fn">expand_real_by_modo()</span>
    </div>
    <div class="pipeline-step">
      <span class="step-num c-gold">E</span>
      <span class="step-label">Validación</span>
      <span class="step-desc">Unicidad por 4 llaves en ambas entradas</span>
      <span class="step-fn">duplicated() check</span>
    </div>
    <div class="pipeline-step">
      <span class="step-num c-teal">F</span>
      <span class="step-label">Outer merge</span>
      <span class="step-desc">Join histórico + forecast, validate m:1</span>
      <span class="step-fn">merge(how="outer")</span>
    </div>
    <div class="pipeline-step">
      <span class="step-num c-teal">G</span>
      <span class="step-label">RMSE</span>
      <span class="step-desc">Solo donde coexisten y_real y yhat</span>
      <span class="step-fn">groupby().mean()</span>
    </div>
    <div class="pipeline-step">
      <span class="step-num c-burgundy">H</span>
      <span class="step-label">Escritura</span>
      <span class="step-desc">Fill, validación NaN, tableau.csv</span>
      <span class="step-fn">to_csv()</span>
    </div>
  </div>

  <div class="card" style="margin-bottom:2rem">
    <h3 style="font-family:var(--font-display);font-size:1.2rem;color:var(--dark-teal);margin-bottom:1rem">Contrato de llaves</h3>
    <p style="font-size:.92rem;color:#555;margin-bottom:1rem">La llave compuesta del dataset final es:</p>
    <div style="display:flex;gap:1rem;flex-wrap:wrap;margin-bottom:.75rem">
      <span class="badge badge-teal">ds</span>
      <span class="badge badge-teal">padecimiento</span>
      <span class="badge badge-teal">entidad</span>
      <span class="badge badge-teal">meta_modo</span>
    </div>
    <p style="font-size:.85rem;color:#777;margin-bottom:1rem"><code>meta_modo</code> indica la segmentación por sexo: <strong>general</strong> (ambos sexos), <strong>hombres</strong> o <strong>mujeres</strong>. Cada combinación de padecimiento, entidad y modo genera un modelo independiente.</p>
    <p style="font-size:.92rem;color:#555">El pipeline exige <strong>unicidad</strong> por esta llave en ambas entradas (histórico expandido y forecast) antes de hacer el merge. El merge es <code>outer</code> para no perder histórico ni forecast, y se usa <code>validate="m:1"</code> para controlar cardinalidad.</p>
  </div>

  <!-- Subsección: Segmentación por sexo — meta_modo -->
  <div class="card" style="margin-bottom:2rem">
    <div class="card-header">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--teal)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
      <h3 class="card-title">Segmentación por sexo &mdash; <code>meta_modo</code></h3>
    </div>
    <p style="font-size:.92rem;color:#555;margin-bottom:1.25rem">El campo <code>meta_modo</code> es la tercera dimensión de la llave compuesta que permite segmentar los datos y las predicciones por sexo. Cada valor genera un modelo Prophet independiente:</p>

    <div style="display:flex;gap:1.25rem;flex-wrap:wrap;margin-bottom:1.5rem">
      <!-- Badge: general -->
      <div style="background:rgba(0,82,78,.07);border:1px solid rgba(0,82,78,.2);border-radius:var(--radius-sm);padding:1rem 1.5rem;flex:1;min-width:180px">
        <div style="display:flex;align-items:center;gap:.5rem;margin-bottom:.5rem">
          <span class="badge badge-teal" style="font-size:.85rem;padding:.25rem .85rem">general</span>
        </div>
        <p style="font-size:.85rem;color:#555;line-height:1.5">Ambos sexos combinados. Usa la columna <code>incrementos_total</code> del histórico. Es la vista por defecto del dashboard.</p>
      </div>
      <!-- Badge: hombres -->
      <div style="background:rgba(155,34,66,.05);border:1px solid rgba(155,34,66,.18);border-radius:var(--radius-sm);padding:1rem 1.5rem;flex:1;min-width:180px">
        <div style="display:flex;align-items:center;gap:.5rem;margin-bottom:.5rem">
          <span class="badge" style="background:rgba(155,34,66,.1);color:var(--burgundy);font-size:.85rem;padding:.25rem .85rem">hombres</span>
        </div>
        <p style="font-size:.85rem;color:#555;line-height:1.5">Solo población masculina. Usa la columna <code>incrementos_hombres</code> del histórico.</p>
      </div>
      <!-- Badge: mujeres -->
      <div style="background:rgba(181,133,0,.06);border:1px solid rgba(181,133,0,.18);border-radius:var(--radius-sm);padding:1rem 1.5rem;flex:1;min-width:180px">
        <div style="display:flex;align-items:center;gap:.5rem;margin-bottom:.5rem">
          <span class="badge badge-yellow" style="font-size:.85rem;padding:.25rem .85rem">mujeres</span>
        </div>
        <p style="font-size:.85rem;color:#555;line-height:1.5">Solo población femenina. Usa la columna <code>incrementos_mujeres</code> del histórico.</p>
      </div>
    </div>

    <p style="font-size:.92rem;color:#555;margin-bottom:.75rem"><strong>Cada combinación padecimiento &times; entidad &times; meta_modo genera un modelo Prophet independiente.</strong> Esto significa que Jalisco-Depresión produce 3 modelos distintos, cada uno entrenado con su propia serie de incidencia.</p>

    <div class="callout" style="margin:1.25rem 0">
      <strong>Triple conteo (<code>expand_real_by_modo</code>):</strong> La función <code>expand_real_by_modo()</code> triplica el histórico INEGI generando una fila por cada modo. Solo el incremento correspondiente al modo queda poblado; los otros dos se dejan como NaN. Esto permite que Tableau filtre por <code>meta_modo</code> sin inflar las sumas agregadas (<code>SUM(incrementos_*)</code>).
    </div>

    <p style="font-size:.92rem;color:#555;margin-bottom:1rem">Ejemplo: una sola fila de Jalisco-Depresión en el histórico se expande en 3 registros independientes:</p>

    <table class="compare-table" style="margin-top:.5rem">
      <thead>
        <tr>
          <th>padecimiento</th>
          <th>entidad</th>
          <th>meta_modo</th>
          <th>y_real</th>
          <th>Modelo Prophet (.pkl)</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>Depresión</code></td>
          <td><code>Jalisco</code></td>
          <td><span class="badge badge-teal">general</span></td>
          <td><code>incrementos_total</code></td>
          <td><code>Prophet_Depresion_Jalisco_general.pkl</code></td>
        </tr>
        <tr>
          <td><code>Depresión</code></td>
          <td><code>Jalisco</code></td>
          <td><span class="badge" style="background:rgba(155,34,66,.1);color:var(--burgundy)">hombres</span></td>
          <td><code>incrementos_hombres</code></td>
          <td><code>Prophet_Depresion_Jalisco_hombres.pkl</code></td>
        </tr>
        <tr>
          <td><code>Depresión</code></td>
          <td><code>Jalisco</code></td>
          <td><span class="badge badge-yellow">mujeres</span></td>
          <td><code>incrementos_mujeres</code></td>
          <td><code>Prophet_Depresion_Jalisco_mujeres.pkl</code></td>
        </tr>
      </tbody>
    </table>
  </div>

  <table class="compare-table">
    <thead>
      <tr><th>Paso</th><th>Función</th><th>Descripción</th></tr>
    </thead>
    <tbody>
      <tr><td><span class="badge badge-teal">A</span></td><td><code>load_inputs()</code></td><td>Lee <code>data_inegi_General.csv</code> (histórico INEGI) y <code>all_forecast.csv</code> (predicciones)</td></tr>
      <tr><td><span class="badge badge-teal">B</span></td><td><code>prepare_inputs()</code></td><td>Parsea <code>Fecha</code>&rarr;<code>ds</code>, mapea columnas del forecast, elimina fechas inválidas</td></tr>
      <tr><td><span class="badge badge-yellow">C</span></td><td>Fix Semana 53</td><td>Desambigua <code>2014-12-29</code> y <code>2025-12-29</code> prefiriendo Semana 53 sobre Semana 1</td></tr>
      <tr><td><span class="badge badge-green">D</span></td><td><code>expand_real_by_modo()</code></td><td>Triplica histórico en 3 modos; solo el incremento correspondiente queda poblado</td></tr>
      <tr><td><span class="badge badge-yellow">E</span></td><td>Validación de duplicados</td><td>Verifica unicidad en <code>[ds, padecimiento, entidad, meta_modo]</code> en ambas entradas</td></tr>
      <tr><td><span class="badge badge-green">F</span></td><td><code>outer merge</code></td><td>Join histórico + forecast por las 4 llaves, <code>validate="m:1"</code></td></tr>
      <tr><td><span class="badge badge-teal">G</span></td><td>RMSE por modelo</td><td>Calcula RMSE solo donde coexisten <code>y_real</code> y <code>yhat</code></td></tr>
      <tr><td><span class="badge badge-green">H</span></td><td>Escritura</td><td>Renombra, fill numérico (excluyendo incrementos), valida llaves, escribe <code>tableau.csv</code></td></tr>
    </tbody>
  </table>
</section>

<!-- ═══════════ 5. PREDICE.PY — METRICAS HIBRIDAS ═══════════ -->
<section class="reveal" id="metricas">
  <h2 class="section-title">Métricas: modelo original vs usado</h2>
  <p class="section-sub">Trazabilidad completa del fallback híbrido en <code>predice.py</code></p>

  <div class="charts-row">
    <div class="card">
      <h3 style="font-family:var(--font-display);font-size:1.2rem;color:var(--dark-teal);margin-bottom:1rem">Modelo propio</h3>
      <p style="font-size:.92rem;color:#555">Para los 256 modelos con <span class="badge badge-green">confianza suficiente</span>, <code>archivo_modelo_original</code> y <code>archivo_modelo_usado</code> apuntan al mismo <code>.pkl</code>. Las métricas original y usado son idénticas.</p>
    </div>
    <div class="card">
      <h3 style="font-family:var(--font-display);font-size:1.2rem;color:var(--dark-teal);margin-bottom:1rem">Fallback regional</h3>
      <p style="font-size:.92rem;color:#555">Para los <strong>41 modelos insuficientes</strong>, el forecast viene del modelo regional pero se desnormaliza con la población <strong>estatal individual</strong>. Las métricas se desdoblan:</p>
      <ul style="font-size:.88rem;color:#555;margin-top:.5rem;padding-left:1.25rem">
        <li><code>rmse_original</code>, <code>mase_original</code> &mdash; del modelo estatal propio</li>
        <li><code>rmse_usado</code>, <code>mase_usado</code> &mdash; del modelo regional fallback</li>
        <li><code>confianza_original</code> = "insuficiente"</li>
        <li><code>confianza_usado</code> = "suficiente"</li>
      </ul>
    </div>
  </div>

  <div class="chart-wrap" style="margin-top:2rem">
    <h3>Distribución de modelos por tipo</h3>
    <p class="chart-sub">297 modelos estatales + 15 regionales de fallback</p>
    <canvas id="chartModelos" height="220"></canvas>
  </div>

  <div class="callout" style="margin-top:2rem">
    <strong>Tooltips informativos en Tableau:</strong> Los tooltips despliegan RMSE, MAE, MAPE, MASE y modelo utilizado, manteniendo la visualización principal limpia mientras el detalle técnico queda disponible bajo demanda. El MASE se clasifica categóricamente: excelente (&lt;0.7), bueno (0.7-1.0), requiere mejora (&gt;1.0).
  </div>
</section>

<!-- ═══════════ 6. VISUALIZACIONES TABLEAU ═══════════ -->
<section class="reveal" id="visualizaciones">
  <h2 class="section-title">Las 8 visualizaciones</h2>
  <p class="section-sub">Embebidas en <code>EpiDashboard.html</code> via Tableau Public JavaScript API</p>

  <div class="viz-grid">
    <div class="viz-card">
      <div class="viz-card-head">
        <span class="viz-card-num">01</span>
        <h3>Tabla de datos</h3>
      </div>
      <div class="viz-card-body">Tabla interactiva con datos epidemiológicos por entidad, año, semana y sexo. Se incorpora información demográfica del INEGI. Filtrable por año, género y padecimiento.</div>
      <div class="viz-card-foot">Tabla de datos &middot; viz_epiforecastmx</div>
    </div>

    <div class="viz-card">
      <div class="viz-card-head">
        <span class="viz-card-num">02</span>
        <h3>Mapa de México</h3>
      </div>
      <div class="viz-card-body">Variables demográficas y territoriales por entidad: densidad poblacional, superficie, casos desagregados por género. Se aplica normalización min-max para gradientes de color coherentes al alternar variables.</div>
      <div class="viz-card-foot">Mapa de México &middot; viz_epiforecastmx</div>
    </div>

    <div class="viz-card">
      <div class="viz-card-head">
        <span class="viz-card-num">03</span>
        <h3>México en categorías</h3>
      </div>
      <div class="viz-card-body">Categorizaciones analíticas: región geográfica, región socio-urbana, densidad poblacional, extensión territorial y ratio por género. Incluye rangos fijos y percentiles para comparaciones estructurales.</div>
      <div class="viz-card-foot">México en categorías &middot; viz_epiforecastmx</div>
    </div>

    <div class="viz-card">
      <div class="viz-card-head">
        <span class="viz-card-num">04</span>
        <h3>Casos por año</h3>
      </div>
      <div class="viz-card-body">Tasa anual de incremento normalizada por población (por 100K hab.), desagregada por género. Recorte visual de extremos preservando valores reales en el detalle.</div>
      <div class="viz-card-foot">Casos por año &middot; viz_epiforecastmx</div>
    </div>

    <div class="viz-card">
      <div class="viz-card-head">
        <span class="viz-card-num">05</span>
        <h3>Casos semanales</h3>
      </div>
      <div class="viz-card-body">Tasa semanal de incremento normalizada, permitiendo analizar la dinámica de corto plazo y detectar variaciones intra-anuales. Recorte por percentiles para legibilidad.</div>
      <div class="viz-card-foot">Casos por semana &middot; viz_epiforecastmx</div>
    </div>

    <div class="viz-card">
      <div class="viz-card-head">
        <span class="viz-card-num" style="background:var(--burgundy)">06</span>
        <h3>Predicción e incertidumbre</h3>
      </div>
      <div class="viz-card-body">Trayectoria estimada del modelo con rango de variación (intervalo de confianza). Filtrable por año. Incluye línea de referencia COVID y banda asociada. <span class="badge badge-yellow">En desarrollo</span></div>
      <div class="viz-card-foot">Predicciones &middot; En migración al dashboard unificado</div>
    </div>

    <div class="viz-card">
      <div class="viz-card-head">
        <span class="viz-card-num" style="background:var(--gold)">07</span>
        <h3>Dash Predicciones</h3>
      </div>
      <div class="viz-card-body">Dashboard integrado: desempeño del modelo (observado vs predicho) + KPIs de confianza + modelo Prophet utilizado. Contrasta puntos observados con línea de predicción continua.</div>
      <div class="viz-card-foot">Dash Predicciones &middot; viz_epiforecastmx</div>
    </div>

    <div class="viz-card">
      <div class="viz-card-head">
        <span class="viz-card-num" style="background:var(--gold)">08</span>
        <h3>Últimas 52 semanas</h3>
      </div>
      <div class="viz-card-body">Ventana temporal de 52 semanas observadas + 52 proyectadas. Resumen del comportamiento reciente y su extensión esperada, clave para la toma de decisiones. <span class="badge badge-yellow">En desarrollo</span></div>
      <div class="viz-card-foot">Últimas 52 semanas &middot; viz_epiforecastmx</div>
    </div>
  </div>
</section>

<!-- ═══════════ 7. MIGRACIÓN A DATASET ÚNICO ═══════════ -->
<section class="reveal" id="migracion">
  <h2 class="section-title">Migración al dataset integrado</h2>
  <p class="section-sub">De dos fuentes fragmentadas a un único <code>tableau.csv</code> con llave homogénea</p>

  <div class="charts-row">
    <div class="card">
      <h3 style="font-family:var(--font-display);font-size:1.15rem;color:var(--burgundy);margin-bottom:.75rem">Antes: arquitectura fragmentada</h3>
      <ul style="font-size:.88rem;color:#555;padding-left:1.25rem;line-height:2">
        <li>Dos fuentes de datos separadas (histórico + forecast)</li>
        <li>Joins implícitos en Tableau (Relationships)</li>
        <li>Filtros sobre campos del histórico excluían filas futuras</li>
        <li>Fechas futuras desaparecían al filtrar por entidad</li>
        <li>Cálculos LOD dependían de la separación de fuentes</li>
        <li>Métricas agregadas infladas por duplicados</li>
      </ul>
    </div>
    <div class="card">
      <h3 style="font-family:var(--font-display);font-size:1.15rem;color:var(--teal);margin-bottom:.75rem">Después: dataset único</h3>
      <ul style="font-size:.88rem;color:#555;padding-left:1.25rem;line-height:2">
        <li>Un solo <code>tableau.csv</code> con llave compuesta</li>
        <li>Todos los registros responden a los mismos filtros</li>
        <li>NaN semántico: ausencia real, no error</li>
        <li>Histórico y forecast conviven sin joins implícitos</li>
        <li>Expresiones LOD recalibradas para una fuente</li>
        <li>Acciones de filtro sin dependencias residuales</li>
      </ul>
    </div>
  </div>

  <div class="card" style="margin-top:2rem">
    <h3 style="font-family:var(--font-display);font-size:1.15rem;color:var(--dark-teal);margin-bottom:.75rem">Reconstrucción del workbook</h3>
    <p style="font-size:.92rem;color:#555">La migración no fue un simple "cambiar fuente": requirió reconstruir sistemáticamente múltiples componentes:</p>
    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:1rem;margin-top:1rem">
      <div style="background:var(--cream-pale);border-radius:var(--radius-sm);padding:1rem">
        <strong style="font-size:.85rem;color:var(--dark-teal)">Fuente de datos</strong>
        <p style="font-size:.82rem;color:#555;margin-top:.25rem">Todas las hojas apuntadas al nuevo CSV con tipos validados</p>
      </div>
      <div style="background:var(--cream-pale);border-radius:var(--radius-sm);padding:1rem">
        <strong style="font-size:.85rem;color:var(--dark-teal)">Campos calculados</strong>
        <p style="font-size:.82rem;color:#555;margin-top:.25rem">Condiciones logicas basadas en meta_modo, WINDOW_* revisadas</p>
      </div>
      <div style="background:var(--cream-pale);border-radius:var(--radius-sm);padding:1rem">
        <strong style="font-size:.85rem;color:var(--dark-teal)">Agregaciones LOD</strong>
        <p style="font-size:.82rem;color:#555;margin-top:.25rem">SUM, AVG, FIXED recalibrados para evitar duplicaciones</p>
      </div>
      <div style="background:var(--cream-pale);border-radius:var(--radius-sm);padding:1rem">
        <strong style="font-size:.85rem;color:var(--dark-teal)">Filtros y parámetros</strong>
        <p style="font-size:.82rem;color:#555;margin-top:.25rem">Globales remapeados, acciones de resaltado verificadas</p>
      </div>
    </div>
  </div>
</section>

<!-- ═══════════ 8. DECISIONES UX ═══════════ -->
<section class="reveal" id="ux">
  <h2 class="section-title">Decisiones UX/UI</h2>
  <p class="section-sub">Diseño centrado en interpretabilidad, no en decoración</p>

  <div class="card-grid-3">
    <div class="card">
      <h3 style="font-family:var(--font-display);font-size:1.1rem;color:var(--dark-teal);margin-bottom:.5rem">Contexto temporal</h3>
      <p style="font-size:.88rem;color:#555">Línea de referencia COVID-19 y ajuste a fecha continua (condición necesaria para bandas en Tableau). Títulos con referencias temporales claras sin sobrecargar.</p>
    </div>
    <div class="card">
      <h3 style="font-family:var(--font-display);font-size:1.1rem;color:var(--dark-teal);margin-bottom:.5rem">MASE categórico</h3>
      <p style="font-size:.88rem;color:#555">Clasificación interpretable: <span class="badge badge-green">Excelente</span> (&lt;0.7), <span class="badge badge-yellow">Bueno</span> (0.7-1.0), <span class="badge badge-red">Mejora</span> (&gt;1.0). El usuario entiende sin interpretar la métrica cruda.</p>
    </div>
    <div class="card">
      <h3 style="font-family:var(--font-display);font-size:1.1rem;color:var(--dark-teal);margin-bottom:.5rem">Tooltips informativos</h3>
      <p style="font-size:.88rem;color:#555">RMSE, MAE, MAPE, MASE y modelo utilizado bajo demanda. La visualización principal queda limpia; el detalle técnico aparece al hover.</p>
    </div>
    <div class="card">
      <h3 style="font-family:var(--font-display);font-size:1.1rem;color:var(--dark-teal);margin-bottom:.5rem">Dashboard integrado</h3>
      <p style="font-size:.88rem;color:#555">Worksheets de predicciones y desempeño se integraron en un único dashboard "Predicciones" con una nueva worksheet "KPIs" (confianza + modelo Prophet).</p>
    </div>
    <div class="card">
      <h3 style="font-family:var(--font-display);font-size:1.1rem;color:var(--dark-teal);margin-bottom:.5rem">Normalización de mapas</h3>
      <p style="font-size:.88rem;color:#555">Normalización min-max para variables con magnitudes muy diferentes (densidad, superficie, casos). El gradiente de color es consistente al alternar variables.</p>
    </div>
    <div class="card">
      <h3 style="font-family:var(--font-display);font-size:1.1rem;color:var(--dark-teal);margin-bottom:.5rem">Ventana 2 años</h3>
      <p style="font-size:.88rem;color:#555">52 semanas históricas + 52 proyectadas. Controlada por parámetro de selección única (workaround a limitación de Tableau). <span class="badge badge-yellow">En desarrollo</span></p>
    </div>
  </div>

  <div class="code-block" style="margin-top:2rem">
    <span class="code-label">Tableau - Normalización para mapas</span>
<span class="cm">// Campo calculado en Tableau:</span>
<span class="cm">// Normaliza cualquier variable al rango [0,1] para coherencia</span>
<span class="cm">// visual al alternar entre densidad, superficie y casos.</span>

(<span class="fn">SUM</span>([Variable seleccionada])
 - <span class="fn">WINDOW_MIN</span>(<span class="fn">SUM</span>([Variable seleccionada])))
/ (<span class="fn">WINDOW_MAX</span>(<span class="fn">SUM</span>([Variable seleccionada]))
 - <span class="fn">WINDOW_MIN</span>(<span class="fn">SUM</span>([Variable seleccionada])))
  </div>
</section>

<!-- ═══════════ 9. EVOLUCIÓN ═══════════ -->
<section class="reveal" id="evolucion">
  <h2 class="section-title">Evolución del dashboard</h2>
  <p class="section-sub">Tres avances iterativos: de tablas básicas a un pipeline integrado</p>

  <div class="timeline">
    <div class="tl-item">
      <div class="tl-version">Avance 2 — Semana 3</div>
      <div class="tl-title">Fundamentos: tablas, mapas y series</div>
      <div class="tl-desc">
        <p>Primeras 5 visualizaciones: tabla de datos interactiva, mapa de México, vista por categorías, casos anuales y semanales. Dashboard ejecutivo comparativo con los 3 padecimientos. Modelo baseline Prophet con cross-validation temporal.</p>
        <div style="display:flex;flex-wrap:wrap;gap:.5rem;margin-top:.75rem">
          <span class="badge badge-teal">Tabla de datos</span>
          <span class="badge badge-teal">Mapa de México</span>
          <span class="badge badge-teal">Categorías</span>
          <span class="badge badge-teal">Casos anuales</span>
          <span class="badge badge-teal">Casos semanales</span>
        </div>
      </div>
    </div>

    <div class="tl-item">
      <div class="tl-version">Avance 3 — Semana 4-5</div>
      <div class="tl-title">Normalización, modelos por estado, dashboard integral</div>
      <div class="tl-desc">
        <p>Se implementó normalización min-max para mapas con variables de magnitudes dispares. Modelo expandido a nivel estatal (99 modelos por padecimiento). Dashboard integral con heatmaps y bump charts de rendimiento.</p>
        <div style="display:flex;flex-wrap:wrap;gap:.5rem;margin-top:.75rem">
          <span class="badge badge-yellow">Min-max maps</span>
          <span class="badge badge-yellow">99 modelos/pad</span>
          <span class="badge badge-yellow">Dashboard integral</span>
        </div>
      </div>
    </div>

    <div class="tl-item">
      <div class="tl-version">Avance 4 — Semana 6</div>
      <div class="tl-title">Pipeline integrado, migración y automatización</div>
      <div class="tl-desc">
        <p>Diagnóstico post-entrenamiento, corrección de Semana 53, política de NaN explícitos, contrato de llaves, expansión por modo, <code>build_tableau.py</code>. Migración a dataset único. Experimento de automatización GitHub Actions &rarr; Google Sheets &rarr; Tableau Public.</p>
        <div style="display:flex;flex-wrap:wrap;gap:.5rem;margin-top:.75rem">
          <span class="badge badge-green">build_tableau.py</span>
          <span class="badge badge-green">Dataset único</span>
          <span class="badge badge-green">Métricas orig/usado</span>
          <span class="badge badge-green">Automatización</span>
        </div>
      </div>
    </div>
  </div>

  <div class="chart-wrap" style="margin-top:2rem">
    <h3>Componentes del dashboard por avance</h3>
    <p class="chart-sub">Crecimiento acumulativo de funcionalidad</p>
    <canvas id="chartEvolucion" height="200"></canvas>
  </div>
</section>

<!-- ═══════════ 10. AUTOMATIZACIÓN ═══════════ -->
<section class="reveal" id="automatizacion">
  <h2 class="section-title">Automatización: GitHub Actions + Google Sheets</h2>
  <p class="section-sub">Validación del principio pipeline &rarr; publicación &rarr; consumo</p>

  <div class="card" style="margin-bottom:2rem">
    <h3 style="font-family:var(--font-display);font-size:1.2rem;color:var(--dark-teal);margin-bottom:1rem">Arquitectura del experimento</h3>
    <div class="flow-diagram">
      <div class="flow-row">
        <div class="flow-box script">GitHub Actions<br><span style="font-size:.7rem;opacity:.6">cron: 0 * * * * (cada hora)</span></div>
        <span class="pipeline-arrow">&rarr;</span>
        <div class="flow-box script">update_sheet.py<br><span style="font-size:.7rem;opacity:.6">gspread + service account</span></div>
        <span class="pipeline-arrow">&rarr;</span>
        <div class="flow-box data">Google Sheets<br><span style="font-size:.7rem;opacity:.6">Dataset público</span></div>
      </div>
      <div class="flow-arrow-down">&darr; <span style="font-size:.7rem;color:var(--cool-gray)">auto-refresh ~24h</span></div>
      <div class="flow-row">
        <div class="flow-box cloud">Tableau Public<br><span style="font-size:.7rem;opacity:.6">Fuente: Google Sheets</span></div>
        <span class="pipeline-arrow">&rarr;</span>
        <div class="flow-box cloud">Web embed<br><span style="font-size:.7rem;opacity:.6">proyectointegrador.org</span></div>
      </div>
    </div>
  </div>

  <div class="charts-row">
    <div class="card">
      <h3 style="font-family:var(--font-display);font-size:1.1rem;color:var(--dark-teal);margin-bottom:.75rem">Identidad no interactiva</h3>
      <p style="font-size:.88rem;color:#555">Service account de Google Cloud como identidad técnica. Credenciales en GitHub Secrets (no versionadas). El Sheet se comparte con el correo de la service account.</p>
      <table class="compare-table" style="margin-top:1rem">
        <thead><tr><th>Componente</th><th>Responsabilidad</th></tr></thead>
        <tbody>
          <tr><td>Google Cloud / IAM</td><td>Control de acceso</td></tr>
          <tr><td>GitHub Actions</td><td>Ejecución automatizada</td></tr>
          <tr><td>Google Sheets</td><td>Persistencia de datos</td></tr>
        </tbody>
      </table>
    </div>
    <div class="card">
      <h3 style="font-family:var(--font-display);font-size:1.1rem;color:var(--dark-teal);margin-bottom:.75rem">Resultados y limitaciones</h3>
      <p style="font-size:.88rem;color:#555">La escritura a Google Sheets funciona correctamente en cada ejecución. La incertidumbre está en <strong>el lado de Tableau Public</strong>: no ofrece control sobre triggers ni schedules de refresh.</p>
      <div class="callout-burgundy callout" style="margin-top:1rem;padding:1rem 1.25rem;font-size:.85rem">
        <strong>Limitacion estructural:</strong> Tableau Public no gestiona credenciales de datos protegidos por diseño. Para una arquitectura robusta y gobernada, la solución correcta es Tableau Cloud o Tableau Server.
      </div>
    </div>
  </div>
</section>

<!-- ═══════════ 11. TABLEAU PUBLIC ═══════════ -->
<section class="reveal" id="tableau-public">
  <h2 class="section-title">Tableau Public: costos y limitaciones</h2>
  <p class="section-sub">Excelente para difusión, no diseñada como plataforma de automatización</p>

  <table class="compare-table">
    <thead>
      <tr><th>Producto</th><th>Costo aprox.</th><th>Refresh programado</th><th>Uso principal</th></tr>
    </thead>
    <tbody>
      <tr><td><strong>Tableau Public</strong></td><td>Gratis</td><td>Solo Google Sheets (~1x/día)</td><td>Publicación abierta</td></tr>
      <tr><td>Tableau Desktop</td><td>~70 USD/mes</td><td>No</td><td>Desarrollo y autoría</td></tr>
      <tr><td>Tableau Cloud (Creator)</td><td>~75 USD/mes</td><td>Sí</td><td>Desarrollo + publicación</td></tr>
      <tr><td>Tableau Cloud (Explorer)</td><td>~42 USD/mes</td><td>Sí</td><td>Exploración interactiva</td></tr>
      <tr><td>Tableau Cloud (Viewer)</td><td>~15 USD/mes</td><td>Sí</td><td>Consumo de dashboards</td></tr>
    </tbody>
  </table>

  <div class="callout" style="margin-top:2rem">
    <strong>Agradecimiento:</strong> Se agradece la colaboración de la Dra. Grettel Barceló Alonso, quien facilitó el acceso a una licencia de Tableau Desktop para el desarrollo del workbook <code>viz_epiforecastmx.twb</code>.
  </div>
</section>

<!-- ═══════════ 12. LECCIONES ═══════════ -->
<section class="reveal" id="lecciones">
  <h2 class="section-title">Lecciones aprendidas</h2>
  <p class="section-sub">Del diagnóstico del Avance 4 al estado actual del pipeline</p>

  <div class="card-grid">
    <div class="card">
      <div class="card-header">
        <div class="card-dot" style="color:var(--teal)"></div>
        <h3 class="card-title">Semántica sobre estética</h3>
      </div>
      <p style="font-size:.92rem;color:#555">Los errores en Tableau no se resolvieron con ajustes visuales. El problema estaba en la estructura del dataset. Los NaN no son errores: son semántica. La visualización es consecuencia de datos bien construidos.</p>
    </div>
    <div class="card">
      <div class="card-header">
        <div class="card-dot" style="color:var(--gold)"></div>
        <h3 class="card-title">Contrato > convencion</h3>
      </div>
      <p style="font-size:.92rem;color:#555">Definir un contrato explícito de llaves (<code>ds, padecimiento, entidad, meta_modo</code>) y validarlo con <code>validate="m:1"</code> previene errores silenciosos que solo se manifiestan en producción.</p>
    </div>
    <div class="card">
      <div class="card-header">
        <div class="card-dot" style="color:var(--burgundy)"></div>
        <h3 class="card-title">Trazabilidad end-to-end</h3>
      </div>
      <p style="font-size:.92rem;color:#555">El desdoblamiento <code>original</code> vs <code>usado</code> en métricas permite auditar exactamente qué modelo generó cada predicción. Con 41 modelos en fallback, la transparencia es crítica.</p>
    </div>
    <div class="card">
      <div class="card-header">
        <div class="card-dot" style="color:var(--teal)"></div>
        <h3 class="card-title">Pipeline reproducible</h3>
      </div>
      <p style="font-size:.92rem;color:#555"><code>make tableau</code> es un único comando que genera el dataset final. Cualquier miembro del equipo puede reconstruir <code>tableau.csv</code> desde cero en cualquier momento.</p>
    </div>
  </div>

  <div class="chart-wrap" style="margin-top:2rem">
    <h3>Anatomia del dataset final: <code>tableau.csv</code></h3>
    <p class="chart-sub">Columnas clave agrupadas por propósito</p>
    <canvas id="chartColumnas" height="250"></canvas>
  </div>
</section>

<!-- ═══════════ 13. FICHA TÉCNICA ═══════════ -->
<section class="reveal" id="ficha">
  <h2 class="section-title">Ficha técnica</h2>
  <p class="section-sub">Resumen de scripts, archivos y comandos del pipeline de visualización</p>

  <table class="compare-table">
    <thead>
      <tr><th>Componente</th><th>Archivo / Comando</th><th>Propósito</th></tr>
    </thead>
    <tbody>
      <tr><td>Predicción</td><td><code>scripts/predice.py</code> / <code>make predict</code></td><td>Genera <code>all_forecast.csv</code> con yhat + métricas orig/usado</td></tr>
      <tr><td>Dataset Tableau</td><td><code>scripts/build_tableau.py</code> / <code>make tableau</code></td><td>Integra histórico + forecast en <code>tableau.csv</code></td></tr>
      <tr><td>Workbook</td><td><code>viz/viz_epiforecastmx.twb</code></td><td>8 visualizaciones interactivas en Tableau</td></tr>
      <tr><td>Web embed</td><td><code>EpiDashboard.html</code></td><td>Página web con embeds Tableau Public JS API</td></tr>
      <tr><td>Automatización</td><td><code>hourly.yml</code> + <code>update_sheet.py</code></td><td>Experimento GitHub Actions &rarr; Google Sheets</td></tr>
      <tr><td>Notebook</td><td><code>notebooks/Avance4_Luis_Reconstruido.ipynb</code></td><td>Documentación completa del proceso (6 secciones)</td></tr>
    </tbody>
  </table>

  <div class="yaml-block" style="margin-top:2rem">
<span class="yaml-cm"># Flujo completo del dashboard</span>
<span class="yaml-key">make</span> <span class="yaml-val">train</span>          <span class="yaml-cm"># 1. Entrenar 297 modelos Prophet</span>
<span class="yaml-key">make</span> <span class="yaml-val">models-push</span>    <span class="yaml-cm"># 2. Subir modelos a S3 (DVC)</span>
<span class="yaml-key">make</span> <span class="yaml-val">predict</span>        <span class="yaml-cm"># 3. Generar all_forecast.csv + fallback híbrido</span>
<span class="yaml-key">make</span> <span class="yaml-val">tableau</span>        <span class="yaml-cm"># 4. Construir tableau.csv (dataset integrado)</span>
<span class="yaml-key">make</span> <span class="yaml-val">forecast-push</span>  <span class="yaml-cm"># 5. Subir forecast a S3</span>
<span class="yaml-cm"># 6. Actualizar Tableau Desktop con nuevo CSV</span>
<span class="yaml-cm"># 7. Publicar en Tableau Public</span>
<span class="yaml-cm"># 8. Verificar embeds en EpiDashboard.html</span>
  </div>
</section>

</div><!-- /container -->

<!-- ═══════════ FOOTER ═══════════ -->
<footer>
  <div class="footer-title">EpiForecast-MX</div>
  <p>Plataforma de inteligencia epidemiológica &middot; IMSS &times; Tec de Monterrey</p>
  <p style="margin-top:.75rem">
    <a href="index.html">Inicio</a> &middot;
    <a href="EpiDashboard.html">Dashboard</a> &middot;
    <a href="reporte_resultados.html">Resultados</a> &middot;
    <a href="Reports/index.html">Pronósticos</a> &middot;
    <a href="bitacora_modelado.html">Bitácora</a> &middot;
    <a href="comparacion_modelos.html">Comparación</a> &middot;
    <a href="ficha_tecnica_prophet.html">Ficha Prophet</a> &middot;
    <a href="hiperparametros_modelos.html">HPs SageMaker</a> &middot;
    <a href="construccion_dashboard.html">Arquitectura Dashboard</a> &middot;
    <a href="conclusiones.html">Conclusiones</a> &middot;
    <a href="referencias.html">Referencias</a>
  </p>
  <p style="margin-top:.5rem">Basado en el Avance 4 de Luis Gerardo Sanchez Salazar (A01232963)</p>
  <p style="margin-top:.5rem;font-family:var(--font-mono);font-size:.75rem;opacity:.5">Generado: 22 febrero 2026</p>
</footer>

<!-- ═══════════ SCRIPTS ═══════════ -->
<script>
/* ── Nav scroll ── */
const nav=document.getElementById('nav');if(nav)window.addEventListener('scroll',()=>nav.classList.toggle('scrolled',window.scrollY>40));

/* ── Reveal on scroll ── */
const obs = new IntersectionObserver(es => {
  es.forEach(e => { if(e.isIntersecting) e.target.classList.add('visible'); });
}, { threshold: 0.08 });
document.querySelectorAll('.reveal').forEach(el => obs.observe(el));

/* ── Smooth scroll for internal links only ── */
document.querySelectorAll('nav a[href^="#"], .toc a[href^="#"]').forEach(a => {
  a.addEventListener('click', e => {
    const href = a.getAttribute('href');
    if (!href || !href.startsWith('#')) return;
    const t = document.querySelector(href);
    if (t) { e.preventDefault(); t.scrollIntoView({ behavior: 'smooth', block: 'start' }); }
  });
});

/* ── Chart: Modelos por tipo ── */
const ctxMod = document.getElementById('chartModelos');
if (ctxMod) new Chart(ctxMod, {
  type: 'bar',
  data: {
    labels: ['Alzheimer', 'Depresión', 'Parkinson'],
    datasets: [
      {
        label: 'Modelo propio',
        data: [63, 99, 94],
        backgroundColor: 'rgba(0,82,78,.7)',
        borderRadius: 6
      },
      {
        label: 'Fallback regional',
        data: [36, 0, 5],
        backgroundColor: 'rgba(155,34,66,.6)',
        borderRadius: 6
      }
    ]
  },
  options: {
    responsive: true,
    plugins: { legend: { position: 'top', labels: { font: { family: "'Source Sans 3'" } } } },
    scales: {
      x: { stacked: true, grid: { display: false }, ticks: { font: { family: "'Source Sans 3'" } } },
      y: { stacked: true, beginAtZero: true, title: { display: true, text: 'Modelos', font: { family: "'Source Sans 3'" } } }
    }
  }
});

/* ── Chart: Evolución ── */
const ctxEvo = document.getElementById('chartEvolucion');
if (ctxEvo) new Chart(ctxEvo, {
  type: 'bar',
  data: {
    labels: ['Avance 2', 'Avance 3', 'Avance 4'],
    datasets: [
      {
        label: 'Vistas Tableau',
        data: [5, 7, 8],
        backgroundColor: 'rgba(0,82,78,.65)',
        borderRadius: 6
      },
      {
        label: 'Scripts pipeline',
        data: [1, 2, 4],
        backgroundColor: 'rgba(181,133,0,.65)',
        borderRadius: 6
      },
      {
        label: 'Campos calculados',
        data: [3, 8, 15],
        backgroundColor: 'rgba(155,34,66,.5)',
        borderRadius: 6
      }
    ]
  },
  options: {
    responsive: true,
    plugins: { legend: { position: 'top', labels: { font: { family: "'Source Sans 3'" } } } },
    scales: {
      x: { grid: { display: false }, ticks: { font: { family: "'Source Sans 3'" } } },
      y: { beginAtZero: true, title: { display: true, text: 'Componentes', font: { family: "'Source Sans 3'" } } }
    }
  }
});

/* ── Chart: Columnas de tableau.csv ── */
const ctxCol = document.getElementById('chartColumnas');
if (ctxCol) new Chart(ctxCol, {
  type: 'doughnut',
  data: {
    labels: ['Llaves (4)', 'Histórico (6)', 'Forecast (5)', 'Métricas original (7)', 'Métricas usado (7)', 'Demográficas (4)', 'Metadata (3)'],
    datasets: [{
      data: [4, 6, 5, 7, 7, 4, 3],
      backgroundColor: [
        'rgba(0,82,78,.8)',
        'rgba(181,133,0,.7)',
        'rgba(155,34,66,.7)',
        'rgba(0,82,78,.5)',
        'rgba(155,34,66,.4)',
        'rgba(92,107,192,.6)',
        'rgba(151,153,155,.5)'
      ],
      borderWidth: 2,
      borderColor: '#FAF6F0'
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: {
        position: 'right',
        labels: { font: { family: "'Source Sans 3'", size: 12 }, padding: 12 }
      }
    }
  }
});
</script>
</body>
</html>
