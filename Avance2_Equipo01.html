<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Documento principal</title>

  <!-- PDF.js desde CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.4.168/pdf.min.mjs" type="module"></script>

  <style>
    :root{
      --neutral-black: #232222;
      --p7420: #9B2242;
      --p7421: #651D32;
      --cool-gray: #D9D9D6;
      --imss-561: #00594C;
      --p627: #13322B;
      --p7402: #ECD898;
      --p1255: #AD841F;
    }

    *{ box-sizing: border-box; margin:0; padding:0; }

    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: #111;
      min-height: 100vh;
      background:
        radial-gradient(900px 600px at 12% 18%, rgba(155, 34, 66, .35), transparent 60%),
        radial-gradient(900px 600px at 88% 20%, rgba(173, 132, 31, .32), transparent 60%),
        radial-gradient(1000px 700px at 30% 90%, rgba(236, 216, 152, .32), transparent 65%),
        linear-gradient(135deg,
          rgba(19, 50, 43, .96) 0%,
          rgba(0, 89, 76, .94) 45%,
          rgba(236, 216, 152, .90) 100%
        );
    }

    /* â”€â”€ Header â”€â”€ */
    header{
      position: sticky;
      top: 0;
      z-index: 100;
      padding: 12px 16px;
      background: rgba(255,255,255,.82);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(217,217,214,.75);
    }

    .head-row{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }

    .title{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 200px;
    }

    .dot{
      width: 12px; height: 12px;
      border-radius: 999px;
      background: var(--p7420);
      box-shadow: 0 0 0 5px rgba(236,216,152,.55);
      flex: 0 0 auto;
    }

    h1{ font-size: 17px; letter-spacing: .2px; color: var(--neutral-black); }

    .actions{ display:flex; gap: 8px; flex-wrap: wrap; }

    .btn{
      display:inline-flex; align-items:center; gap: 6px;
      padding: 9px 14px; border-radius: 10px;
      text-decoration:none; font-size: 13px; font-weight: 500;
      line-height: 1; cursor: pointer;
      border: 1px solid rgba(217,217,214,.95);
      background: rgba(255,255,255,.85);
      color: #111; transition: background .15s;
    }
    .btn:hover{ background: rgba(255,255,255,.98); }
    .btn.open{ border-color: rgba(0,89,76,.55); background: rgba(0,89,76,.12); }
    .btn.down{ border-color: rgba(155,34,66,.55); background: rgba(155,34,66,.10); }

    /* â”€â”€ Toolbar (navegaciÃ³n de pÃ¡ginas y zoom) â”€â”€ */
    .toolbar{
      position: sticky;
      top: 54px;
      z-index: 90;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 8px 12px;
      background: rgba(35,34,34,.92);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      color: #eee;
      font-size: 13px;
      flex-wrap: wrap;
    }

    .toolbar button{
      background: rgba(255,255,255,.12);
      border: 1px solid rgba(255,255,255,.18);
      color: #eee;
      border-radius: 8px;
      padding: 6px 12px;
      font-size: 13px;
      cursor: pointer;
      transition: background .15s;
      line-height: 1;
    }
    .toolbar button:hover{ background: rgba(255,255,255,.22); }
    .toolbar button:disabled{ opacity: .35; cursor: default; }

    .toolbar .page-info{
      min-width: 90px;
      text-align: center;
      font-variant-numeric: tabular-nums;
    }

    .toolbar .sep{
      width: 1px; height: 20px;
      background: rgba(255,255,255,.2);
      margin: 0 4px;
    }

    /* â”€â”€ PDF container â”€â”€ */
    main{
      padding: 0 0 24px;
    }

    #pdf-container{
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      padding: 16px 8px;
      min-height: calc(100vh - 120px);
    }

    #pdf-container canvas{
      max-width: 100%;
      height: auto !important;
      border-radius: 6px;
      box-shadow: 0 4px 20px rgba(0,0,0,.25);
      background: #fff;
    }

    /* â”€â”€ Loading & Error states â”€â”€ */
    .state-msg{
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 14px;
      min-height: 50vh;
      color: rgba(255,255,255,.85);
      font-size: 15px;
      text-align: center;
      padding: 20px;
    }

    .spinner{
      width: 36px; height: 36px;
      border: 3px solid rgba(255,255,255,.2);
      border-top-color: var(--p7402);
      border-radius: 50%;
      animation: spin .7s linear infinite;
    }
    @keyframes spin{ to{ transform: rotate(360deg); } }

    .error-icon{ font-size: 38px; }

    .fallback-link{
      display: inline-flex; align-items: center; gap: 8px;
      padding: 12px 22px; border-radius: 12px;
      background: var(--p7420); color: #fff;
      text-decoration: none; font-weight: 600;
      font-size: 15px; transition: background .15s;
    }
    .fallback-link:hover{ background: var(--p7421); }

    /* â”€â”€ Responsive â”€â”€ */
    @media (max-width: 520px){
      header{ padding: 10px 12px; }
      h1{ font-size: 15px; }
      .toolbar{ top: 48px; gap: 4px; padding: 6px 8px; }
      .toolbar button{ padding: 5px 8px; font-size: 12px; }
      .toolbar .page-info{ font-size: 12px; min-width: 70px; }
    }
  </style>
</head>

<body>
  <header>
    <div class="head-row">
      <div class="title">
        <span class="dot" aria-hidden="true"></span>
        <h1>Documento principal</h1>
      </div>
      <div class="actions">
        <a class="btn open" href="Avance2.Equipo01.pdf" target="_blank" rel="noopener">
          <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
          Abrir
        </a>
        <a class="btn down" href="Avance2.Equipo01.pdf" download>
          <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          Descargar
        </a>
      </div>
    </div>
  </header>

  <!-- Toolbar de navegaciÃ³n -->
  <div class="toolbar" id="toolbar" style="display:none;">
    <button id="btn-prev" disabled title="PÃ¡gina anterior">â—€</button>
    <span class="page-info" id="page-info">â€” / â€”</span>
    <button id="btn-next" disabled title="PÃ¡gina siguiente">â–¶</button>
    <span class="sep"></span>
    <button id="btn-zout" title="Alejar">âˆ’</button>
    <button id="btn-zin" title="Acercar">+</button>
    <button id="btn-fit" title="Ajustar al ancho">â†” Ajustar</button>
  </div>

  <main>
    <div id="pdf-container">
      <!-- Estado de carga -->
      <div class="state-msg" id="loading-msg">
        <div class="spinner"></div>
        <span>Cargando documentoâ€¦</span>
      </div>
    </div>
  </main>

  <script type="module">
    // â”€â”€â”€ PDF.js setup â”€â”€â”€
    const pdfjsLib = await import('https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.4.168/pdf.min.mjs');
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.4.168/pdf.worker.min.mjs';

    const PDF_URL = 'Avance2.Equipo01.pdf';
    const container = document.getElementById('pdf-container');
    const loadingMsg = document.getElementById('loading-msg');
    const toolbar    = document.getElementById('toolbar');
    const pageInfo   = document.getElementById('page-info');

    const btnPrev = document.getElementById('btn-prev');
    const btnNext = document.getElementById('btn-next');
    const btnZin  = document.getElementById('btn-zin');
    const btnZout = document.getElementById('btn-zout');
    const btnFit  = document.getElementById('btn-fit');

    let pdfDoc     = null;
    let totalPages = 0;
    let currentPage= 1;

    const isMobile = window.innerWidth < 768;
    let   scale    = isMobile ? 1.0 : 1.5;
    const SCALE_STEP = 0.25;
    const SCALE_MIN  = 0.5;
    const SCALE_MAX  = 4.0;

    // â”€â”€â”€ Renderizar una pÃ¡gina â”€â”€â”€
    async function renderPage(num){
      const page = await pdfDoc.getPage(num);
      const viewport = page.getViewport({ scale });

      let canvas = document.getElementById('pdf-canvas-' + num);
      if(!canvas){
        canvas = document.createElement('canvas');
        canvas.id = 'pdf-canvas-' + num;
        container.appendChild(canvas);
      }

      const ctx = canvas.getContext('2d');
      const dpr = window.devicePixelRatio || 1;

      canvas.width  = viewport.width  * dpr;
      canvas.height = viewport.height * dpr;
      canvas.style.width  = viewport.width  + 'px';
      canvas.style.height = viewport.height + 'px';

      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

      await page.render({ canvasContext: ctx, viewport }).promise;
    }

    // â”€â”€â”€ Renderizar TODAS las pÃ¡ginas (scroll continuo) â”€â”€â”€
    async function renderAllPages(){
      container.querySelectorAll('canvas').forEach(c => c.remove());

      for(let i = 1; i <= totalPages; i++){
        await renderPage(i);
      }
      updateToolbar();
    }

    // â”€â”€â”€ Scroll a una pÃ¡gina especÃ­fica â”€â”€â”€
    function scrollToPage(num){
      const canvas = document.getElementById('pdf-canvas-' + num);
      if(canvas){
        canvas.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
      currentPage = num;
      updateToolbar();
    }

    function updateToolbar(){
      pageInfo.textContent = currentPage + ' / ' + totalPages;
      btnPrev.disabled = currentPage <= 1;
      btnNext.disabled = currentPage >= totalPages;
    }

    // â”€â”€â”€ Detectar pÃ¡gina visible (Intersection Observer) â”€â”€â”€
    function setupPageObserver(){
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(e => {
          if(e.isIntersecting && e.intersectionRatio > 0.3){
            const id = e.target.id;
            const num = parseInt(id.split('-').pop(), 10);
            if(num && num !== currentPage){
              currentPage = num;
              updateToolbar();
            }
          }
        });
      }, { threshold: [0.3, 0.6] });

      container.querySelectorAll('canvas').forEach(c => observer.observe(c));
    }

    // â”€â”€â”€ Controles â”€â”€â”€
    btnPrev.addEventListener('click', () => {
      if(currentPage > 1) scrollToPage(currentPage - 1);
    });
    btnNext.addEventListener('click', () => {
      if(currentPage < totalPages) scrollToPage(currentPage + 1);
    });
    btnZin.addEventListener('click', async () => {
      if(scale < SCALE_MAX){ scale += SCALE_STEP; await renderAllPages(); setupPageObserver(); }
    });
    btnZout.addEventListener('click', async () => {
      if(scale > SCALE_MIN){ scale -= SCALE_STEP; await renderAllPages(); setupPageObserver(); }
    });
    btnFit.addEventListener('click', async () => {
      if(!pdfDoc) return;
      const page = await pdfDoc.getPage(1);
      const vp = page.getViewport({ scale: 1 });
      const availWidth = container.clientWidth - 16;
      scale = availWidth / vp.width;
      await renderAllPages();
      setupPageObserver();
    });

    // â”€â”€â”€ Teclado â”€â”€â”€
    document.addEventListener('keydown', (e) => {
      if(e.key === 'ArrowLeft' || e.key === 'ArrowUp'){
        e.preventDefault(); if(currentPage > 1) scrollToPage(currentPage - 1);
      } else if(e.key === 'ArrowRight' || e.key === 'ArrowDown'){
        e.preventDefault(); if(currentPage < totalPages) scrollToPage(currentPage + 1);
      }
    });

    // â”€â”€â”€ Cargar PDF â”€â”€â”€
    try {
      pdfDoc = await pdfjsLib.getDocument(PDF_URL).promise;
      totalPages = pdfDoc.numPages;

      loadingMsg.remove();
      toolbar.style.display = 'flex';

      await renderAllPages();
      setupPageObserver();

    } catch(err){
      console.error('Error cargando PDF:', err);

      loadingMsg.innerHTML = `
        <span class="error-icon">ðŸ“„</span>
        <span>No se pudo renderizar el PDF en este navegador.</span>
        <a class="fallback-link" href="${PDF_URL}" target="_blank" rel="noopener">
          <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          Abrir / Descargar PDF
        </a>
      `;
    }

    // â”€â”€â”€ Re-render al cambiar tamaÃ±o de ventana â”€â”€â”€
    let resizeTimer;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(async () => {
        if(pdfDoc){
          await renderAllPages();
          setupPageObserver();
        }
      }, 300);
    });
  </script>
</body>
</html>
